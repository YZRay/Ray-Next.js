---
title: ä½¿ç”¨ View Transitions API å¯¦ç¾å‹•æ…‹åˆ‡æ›
date: 2024-04-18
Image: https://imgur.com/GAZgqO4.jpeg
author: Ray
excerpt: ç´€éŒ„ä¸€ä¸‹å­¸ç¿’ä½¿ç”¨ view transition api ä¸¦å¯¦åšå‡ºä¸€äº›å‹•ç•«æ•ˆæœ
tags:
  - javascript
---

## startViewTransition() API ä»‹ç´¹

> é€™å€‹ API é‚„åœ¨å¯¦é©—æ€§çš„éšæ®µï¼Œç›®å‰ç‚ºæ­¢ç€è¦½å™¨çš„æ”¯æ´ç‡é‚„ä¸æ˜¯å¾ˆæ™®åŠï¼Œæˆ‘å€‘å¯ä»¥å¾ Can I use æŸ¥åˆ°ç›®å‰ç€è¦½å™¨æ”¯æ´çš„æ¯”ä¾‹

![can i use åœ–ç‰‡](https://imgur.com/wCpIIch.jpeg)

View Transitions API ä»–çš„æ–¹æ³•å°±æ˜¯æœƒåœ¨å…©å€‹æª”æ¡ˆä¹‹é–“å»ºç«‹ä¸€å€‹éæ¸¡çš„å‹•ç•«ï¼Œç•¶æˆ‘å€‘å‘¼å«ä»–çš„æ™‚å€™ï¼Œä»–æœƒåœ¨æˆ‘å€‘ç•¶å‰çš„é é¢å»ºç«‹ä¸€å€‹å¿«ç…§ï¼Œå°±åƒæ˜¯åœ¨ä½ ç•¶å‰é é¢æˆªåœ–ï¼Œæ¥è‘—å°±æœƒé–‹å§‹å°ç¶²é ä¸Šçš„å…§å®¹é€²è¡Œè®Šæ›ï¼Œç„¶å¾Œå†ä¸€æ¬¡çš„ç´€éŒ„ï¼ˆä½†é€™æ¬¡æ˜¯è®ŠåŒ–éå¾Œçš„ï¼‰ï¼Œå†ä¾†ä»–æœƒå°‡èˆŠçš„é é¢è®“ä»–æœ‰ä¸€å€‹é€æ˜åˆ° 1~0 çš„è®ŠåŒ–ï¼Œæ–°çš„å‰‡æ˜¯ 0~1ï¼Œä½¿ç”¨æˆ¶èƒ½å¤ çœ‹åˆ°é€™æ®µéæ¸¡çš„å‹•ç•«æ•ˆæœã€‚

> åœ¨è®ŠåŒ–çš„éç¨‹ç¶²é æœƒåœæ­¢æ¸²æŸ“ï¼Œæˆ‘å€‘ä¹Ÿç„¡æ³•åœ¨ç¶²é ä¸Šé€²è¡Œä»»ä½•äº’å‹•æˆ–é»æ“Šæ•ˆæœ

åœ¨è®ŠåŒ–çš„éç¨‹ï¼Œæœƒåœ¨ç€è¦½å™¨ä¸­æ·»åŠ é€™äº›å½å…ƒç´ 

```html
::view-transition 
â””â”€ ::view-transition-group(root)
   â””â”€::view-transition-image-pair(root) 
     â”œâ”€ ::view-transition-old(root) 
     â””â”€ ::view-transition-new(root)
```

::view-transition-old å°±æ˜¯èˆŠçš„å¿«ç…§ï¼Œ::view-transition-new å‰‡æ˜¯æ–°çš„è¢«æ›´æ”¹éå¾Œçš„æ¨£å­

ä»–çš„å‹•ç•«æ˜¯å®Œå…¨å¯ä»¥ç”± CSS ä¾†åšæ§åˆ¶çš„

```css
::view-transition-new(root) {
  animation-duration: 5s;
}
```

é™¤äº†å¯ä»¥åƒé€™æ¨£æ§åˆ¶æ™‚é–“ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åƒæ˜¯åœ¨å¯«ä¸€èˆ¬ css çš„å‹•ç•«ä¸€æ¨£ï¼Œåªè¦è¨­å®šå¥½æˆ‘å€‘æƒ³è¦çš„ keyframes å°±èƒ½å¤ è‡ªå·±å‰µå»ºä¸€å€‹ç¨ç‰¹çš„éæ¸¡å‹•ç•«ï¼Œåªè¦è¨˜å¾— old æ˜¯èˆŠçš„ç•«é¢ï¼Œnew æ˜¯æ–°çš„ç•«é¢ï¼Œå°±å¯ä»¥ä¾†å¯«ä¸Šé€²å…¥è·Ÿé›¢é–‹æ™‚çš„å‹•ç•«æ•ˆæœäº†ã€‚

```css
@keyframes slide-out {
  to {
    transform: translateY(-100%);
  }
}
::view-transition-old(root) {
  animation: 300ms linear both slide-out;
}
```

### åœ¨ä¸åŒå…ƒç´ ä¸Šé€²è¡Œå‹•ç•«

å‰›å‰›ä¸Šè¿°éƒ½æ˜¯åœ¨ root ä¸Šå»åšè®ŠåŒ–ï¼Œé‚£å¦‚æœåªæƒ³è¦å–®ä¸€å…ƒç´ å»ä½¿ç”¨é€™å€‹ API çš„è©±ï¼Œåªéœ€è¦çµ¦ä»–å€‹åç¨±å°±å¯ä»¥äº†ï¼Œå¯ä»¥ä½¿ç”¨ view-transition-name é€™å€‹å±¬æ€§

```css
element {
  view-transition-name: new-element;
}
```

æ¥è‘—ä»–å°±æœƒä»¥ä½ é€™å€‹å‘½åçš„æ–¹å¼å»ç”Ÿæˆæ–°çš„å½å…ƒç´ ï¼Œå°±èƒ½åœ¨ä¸åŒçš„å…ƒç´ ä¸Šå»é€²è¡Œè½‰æ›äº†

> view-transition-nameÂ  ä¸èƒ½æ˜¯é‡è¤‡çš„ï¼Œå¦‚æœå¤šå€‹å…ƒç´ åŒæ™‚å…·æœ‰ç›¸åŒçš„ Â view-transition-nameï¼Œç³»çµ±æœƒç•¥éè½‰å ´æ•ˆæœã€‚

```html
::view-transition 
â””â”€ ::view-transition-group(root)
   â””â”€::view-transition-image-pair(root) 
     â”œâ”€ ::view-transition-old(root)
     â””â”€ ::view-transition-new(root)
```

## å¯¦éš›ä½¿ç”¨ startViewTransition()

<CodeEmbed
  id="preview/BaEdqWo?default-tab=result&theme-id=dark"
  title="View Transitions API Remove Element"
  type="0"
/>

å…ˆé™„ä¸Šç¯„ä¾‹ï¼Œé€™æ˜¯ä¸€å€‹å–®ç´”ç§»é™¤æ‰è³‡æ–™çš„ç¯„ä¾‹ï¼Œæ­£å¸¸æ¸…æ³ä¸‹æ²’æœ‰ç‰¹åˆ¥å»è™•ç†ç§»é™¤æ‰çš„å…ƒç´ ï¼Œå°±åªæœƒå–®ç´”æ¶ˆå¤±è€Œä¸æœƒæœ‰ä¸€å€‹éæ¸¡çš„è®ŠåŒ–ï¼Œä½†æˆ‘å€‘åŠ ä¸Šäº† startViewTransition() é€™å€‹ API å¾Œï¼Œå¯ä»¥ç™¼ç¾åœ¨åˆªé™¤å…ƒç´ æ™‚ï¼Œä»–ä¸æ˜¯ç›´æ¥æ¶ˆå¤±çš„ã€‚

å®ƒçš„ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œåªéœ€è¦åŠ ä¸Š document.startViewTransition() åœ¨ä½ æƒ³è¦åŸ·è¡Œçš„åœ°æ–¹å°±å¯ä»¥äº†ã€‚

```javascript
const removeHandler = (id) => {
  document.startViewTransition(() => {
    setDummy(dummy.filter((item) => item.id !== id));
  });
};
```

å› ç‚ºé€™é …åŠŸèƒ½é‚„åœ¨å¯¦é©—ä¸­ï¼Œæœ‰è¨±å¤šçš„ç€è¦½å™¨é‚„æ²’è¾¦æ³•ä½¿ç”¨å€‹ API ï¼Œæ‰€ä»¥å¯ä»¥åŠ ä¸Šåˆ¤æ–·é€™å€‹ç€è¦½å™¨æ˜¯å¦å¯ä»¥ä½¿ç”¨å†ä¾†åŸ·è¡Œ

```javascript
if (!document.startViewTransition) {
  setDummy(dummy.filter((item) => item.id !== id));
}
//å¦‚æœç€è¦½å™¨ä¸æ”¯æ´é€™å€‹ API å°±ç›´æ¥åŸ·è¡Œ
```

<CodeEmbed
  id="preview/OJGjWdE?default-tab=result&theme-id=dark"
  title="View Transitions API"
  type="0"
/>

ä¹Ÿå¯ä»¥é‹ç”¨é€™å€‹ä¾†å»ºç«‹ä¸€äº›ç‰¹åˆ¥çš„è®ŠåŒ–ï¼Œåƒæ˜¯ä½¿ç”¨å®ƒä¾†é€²è¡Œ dark mode çš„åˆ‡æ›å‹•ç•«

```javascript
const toggleRef = useRef(null);

const { top, left } = toggleRef.current.getBoundingClientRect(); // ç”¨ ref ä¾†å–å¾—ç•¶å‰æŒ‰éˆ•çš„ä½ç½®
const right = window.innerWidth - left;
const bottom = window.innerHeight - top;
const maxRadius = Math.hypot(Math.max(left, right), Math.max(top, bottom)); // è¨ˆç®—å‡ºæŒ‰éˆ•åˆ°é é¢æœ€é çš„åŠå¾‘è·é›¢ï¼Œä¹Ÿå°±æ˜¯ç›´è§’ä¸‰è§’å½¢æœ€é•·çš„é‚Š

const circleAnimate = [
  `circle(0px at ${left}px ${top}px)`,
  `circle(${maxRadius}px at ${left}px ${top}px)`,
];

document.documentElement.animate(
  {
    clipPath: circleAnimate,
  },
  {
    duration: 1000,
    easing: "cubic-bezier(.04,.56,.8,.47)",
    pseudoElement: "::view-transition-new(root)",
  }
);
```

å¤§æ¦‚æ˜¯é€™æ¨£å»åšè¨ˆç®—å¾é»æ“Šä½ç½®åˆ°é é¢çš„æœ€é è™•

![è¨ˆç®—æœ€é è·é›¢åœ–ç‰‡](https://imgur.com/Kk2h9xi.jpeg)

---

[ä½¿ç”¨ View Transitions API æµæš¢å¿«é€Ÿåœ°è½‰æ› Â |Â  Web Platform Â |Â  Chrome for Developers](https://developer.chrome.com/docs/web-platform/view-transitions?hl=zh-tw#how-these-transitions-work)

[Document: startViewTransition() method - Web APIs | MDN (mozilla.org)](https://developer.mozilla.org/en-US/docs/Web/API/Document/startViewTransition)

[ä½¿ç”¨ View Transitions API æ„å»ºä¼˜é›…çš„åŠ¨ç”»æ•ˆæœ ğŸ’¢ğŸ’¢ğŸ’¢ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7282889267028770877)
